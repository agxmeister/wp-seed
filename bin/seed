#!/usr/local/bin/php
<?php

require __DIR__ . '/../vendor/autoload.php';

use DI\Container;
use Minicli\App;
use Monolog\Formatter\LineFormatter;
use Monolog\Handler\StreamHandler;
use Monolog\Level;
use Monolog\Logger;

$app = new App();
$app->setSignature('./seed get-different-paths');

$container = new Container([
    Logger::class => DI\factory(function () {
        $logger = new Logger('log');

        $fileHandler = new StreamHandler('./main.log', Level::Debug);
        $fileHandler->setFormatter(new LineFormatter());
        $logger->pushHandler($fileHandler);

        return $logger;
    }),
]);

$commands = require __DIR__ . '/../app/commands.php';
$commands($app, $container);

try {
    $app->runCommand($argv);
} catch (Throwable $e) {
    echo 'An error occurred running the command: ',  $e->getMessage(), "\n";
}
